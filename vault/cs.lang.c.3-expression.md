---
id: 83n7d8g1zdtyevvbxy67vke
title: 3 复杂表达式
desc: ''
updated: 1659607004370
created: 1659602771178
---

# 复杂表达式

我们之前介绍了表达式的基本含义，现在来些更复杂的表达式

![[cs.lang.c.1-const#表达式,0:#*]]

```mermaid
graph LR
o[更多的相加方法] --> a[初始化initialization]
```

## 变量初始化

```C
unsigned long long int cusum(unsigned long long int r);
int main(){
    unsigned long long int n = 1, sum = 0;
    unsigned long long int res = cusum(1000);
}
```

在变量`n`和`sum`的声明中，标识符`n`和`sum`分别用`=`连接了一定初始值的成分，这个成分叫作初始化器。
在`main`函数内，变量`res`的声明里也有一个初始化器`cusum(1000)`，这显然是一个函数调用表达式；

>! 我们在讨论声明而不是表达式，符号`=`并不是数学里的等于，也不是赋值表达式里面的赋值运算符，是一种新的用法，含义可理解为“来自”

初始化器的作用是在变量创建时，自动地为它赋予一个初始的值。初始化器可以是表达式，比如这里的0、1和`cusum(1000)`。

>! 注意，并不是所有的变量在声明时都可以有初始化器，**函数参数的声明里不得含有初始化器**，这就是说，参数`r`的声明不允许与用`=`连接一个初始化器，与其他语言不同。

### Checkpoint

实验一下，如果为函数`cusum`的参数`r`添加一个初始化器，会怎么样？

> C语言不支持函数的参数声明带有初始化器，这将导致编译时的错误。

## 复合赋值与递增运算符

```diff c
    while(n <= r){
-        sum = sum + n;
+        sum += n;
-        n = n + 1;
+        n ++;
    }
```

使用复合赋值运算符中的`+=`优化了赋值过程。`+=`中的`+`和`=`必须连写，不能分开。

### 使用复合赋值运算符优势

表达式`sum += n`等价于表达式`sum = sum + n`，但在语义上并不一样：

- `sum += n` 将变量`n`的值加到变量`sum`，对变量值操作一次（只需要一条将变量`n`的值加到变量`sum`的机器指令或汇编指令）

- `sum = sum + n` 是读取`sum`和`n`的值相加后再保存到变量`sum`，对变量`sum`操作两次（需要先读取变量`sum`的值，再保存新值到变量`sum`，这需要两条机器指令或者汇编语言的指令）

### 递增运算符

前缀递增运算符和后缀递增运算符的操作数需要是`左值`，且不执行左值转换，像`++ 5`和`6 ++`都是非法的。

![[cs.lang.c.1-const#左值和左值转换,0:#*]]

**相同点：**副作用都是使得变量`n`加一；

**区别：**在前缀表达式中，表达式的`值`是操作数+1的值，而后缀表达式中则是+1前的原值；

例如：

```C
int main(void){
    int x = 0, y, z;
    y = ++ x; //D1 y = 1
    z = x ++; //D2 z = 1, x = 2;
}
```
Debug过程：

- `D1` y = 1, x = 1

此处的`y`赋值为`++ x`的值（0 + 1）

```log
(gdb) p y
$2 = 1
(gdb) p x
$3 = 1
```

- `D2` z = 1, x = 2;

此处的`y`赋值为`x ++`的值（1）

```log
(gdb) p z
$4 = 1
(gdb) p x
$5 = 2
```

### Checkpoint

1. 以下改动是否合法？

```diff
- sum = sum + n ++;
+ sum = sum + ++ n;
```

编译器角度：合法；

结果角度：不合法，结果已改变，本来值是`sum + n`，现在值是`sum + n + 1`;

2. 更正以下程序的错误

```C
unsigned long long int cusum(unsigned long long int r){
    unsigned long long int n = 0, sum = 0;
    while (n < r){
-        sum = sum + n = n + 1;
+        sum += n ++;
    }
    return sum;
}
```

3. 所有关系运算符的优先级都相同，而且都是从左往右结合的；加性运算符`+`也是从左往右结合的，而且它的优先级高于关系运算符。给定以下函数f:

```c
int f (int a, int b, int c, int d, int e, int f){
    return a + b + c > d > e <= f;
}
```

如果调用它的表达式为`f (1, 2, 3, 7, 8, 9)` ，则：

a. 表达式`c > d > e <= f` 的意思是变量`c`的值大于变量`d`的值，变量`d`的值大于变量`e`的值；变量`e`的值大于变量`f`的值，对吗？为什么？

b. 为表达式`a + b + c > d > e <= f` 添加适当的括号，以体现哥运算符的操作数都是谁

c. 函数`f`的返回值是多少？ 请验证结果。
